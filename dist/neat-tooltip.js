/// <reference path="typings/tsd.d.ts" />
var Tooltip;
(function (_Tooltip) {
    _Tooltip.activeTooltip;
    (function (Mode) {
        Mode[Mode["bottom"] = 0] = "bottom";
        Mode[Mode["top"] = 1] = "top";
    })(_Tooltip.Mode || (_Tooltip.Mode = {}));
    var Mode = _Tooltip.Mode;
    (function (Content) {
        Content[Content["title"] = 0] = "title";
        Content[Content["href"] = 1] = "href";
    })(_Tooltip.Content || (_Tooltip.Content = {}));
    var Content = _Tooltip.Content;
    (function (ShowOn) {
        ShowOn[ShowOn["hover"] = 0] = "hover";
        ShowOn[ShowOn["click"] = 1] = "click";
    })(_Tooltip.ShowOn || (_Tooltip.ShowOn = {}));
    var ShowOn = _Tooltip.ShowOn;
    function close() {
        if (_Tooltip.activeTooltip)
            _Tooltip.activeTooltip.close();
    }
    //Indicates if a jquery set contains a given DOM node
    function $contains($set, elem, includeSelf) {
        if (includeSelf === void 0) { includeSelf = true; }
        var e = this;
        for (var i = 0; i < e.length; i++) {
            if ((includeSelf && e.get(i) == elem) || $.contains(e.get(i), elem))
                return true;
        }
        return false;
    }
    ;
    (function ($) {
        $.fn.tooltip = function (options) {
            options = $.extend({
                mode: 0 /* bottom */,
                content: 0 /* title */,
                cssClass: '',
                showOn: 0 /* hover */,
                closeSelector: '.tooltip-close',
                distance: 5
            }, options);
            return this.each(function () {
                var t = new Tooltip(this, options);
            });
        };
        $('html').click(function (ev) {
            //Hide tooltip on click outside target element and popup
            var $active = _Tooltip.activeTooltip.tooltip.add(_Tooltip.activeTooltip.target);
            if (_Tooltip.activeTooltip && !$contains($active, ev.target))
                _Tooltip.activeTooltip.close();
        });
        $(window).resize(function () {
            if (_Tooltip.activeTooltip)
                _Tooltip.activeTooltip.position();
        });
    })(jQuery);
    var Tooltip = (function () {
        function Tooltip(targetElem, options) {
            var _this = this;
            this.targetElem = targetElem;
            this.options = options;
            targetElem['tooltip'] = this;
            this.target = $(targetElem).addClass('has-tooltip');
            var that = this;
            if (options.showOn == 0 /* hover */) {
                //Reaffect target to fix bug on cloned elements.
                var show = function () {
                    that.target = $(this);
                    that.show();
                };
                this.target.hover(show, function () { return _this.close(); }).click(show);
            }
            else {
                this.target.click(function () {
                    that.target = $(this);
                    that.toggle();
                    return false;
                });
            }
        }
        Tooltip.prototype.initContent = function () {
            var _this = this;
            if (this.content)
                return;
            if (this.options.content == 0 /* title */) {
                var title = this.target.attr('title');
                if (!title)
                    return;
                this.target.attr('data-title', title).attr('title', '');
                this.content = $('<span/>').html(title);
            }
            else {
                this.content = $(this.target.attr('href'));
                if (!this.content.length)
                    this.content = null;
            }
            if (this.content)
                this.content.find(this.options.closeSelector).click(function () {
                    _this.close();
                    return false;
                });
        };
        Tooltip.prototype.toggle = function () {
            if (this.tooltip)
                this.close();
            else
                this.show();
        };
        Tooltip.prototype.show = function () {
            this.initContent();
            if (!this.content)
                return;
            if (_Tooltip.activeTooltip)
                _Tooltip.activeTooltip.close();
            var e = this.target;
            var o = this.options;
            var t = this.tooltip = $('<div class="tooltip-frame"/>').addClass(o.cssClass).addClass('tooltip-' + Mode[o.mode]).append(this.content.show()).append($('<div class="tip"/>')).appendTo('body');
            _Tooltip.activeTooltip = this;
            this.position();
        };
        Tooltip.prototype.position = function () {
            var margin = 10;
            var t = this.tooltip;
            var e = this.target;
            var o = this.options;
            if (!t)
                return;
            //Reset so dimentions calculations are correct
            t.removeAttr('style');
            var offset = e.offset();
            var ww = $(window).width();
            var w = t.outerWidth();
            var left = offset.left + e.outerWidth() / 2 - w / 2;
            if (left < margin)
                left = margin;
            var rightOverflow = (left + w) - (ww - margin);
            if (rightOverflow > 0)
                left = Math.max(left - rightOverflow, margin);
            t.css({
                'left': left + 'px',
                'max-width': (ww - left - margin) + 'px'
            }).find('.tip').css('left', offset.left + e.outerWidth() / 2 - left + 'px');
            //Setting width can make height vary. So we set vertical position after.
            var h = t.outerHeight();
            t.css('top', o.mode == 1 /* top */ ? offset.top - h - o.distance : offset.top + e.outerHeight() + o.distance);
        };
        Tooltip.prototype.close = function () {
            if (!this.tooltip)
                return;
            this.content.hide().appendTo('body');
            this.tooltip.remove();
            this.tooltip = null;
            _Tooltip.activeTooltip = null;
        };
        return Tooltip;
    })();
    _Tooltip.Tooltip = Tooltip;
})(Tooltip || (Tooltip = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5lYXQtdG9vbHRpcC50cyJdLCJuYW1lcyI6WyJUb29sdGlwIiwiVG9vbHRpcC5Nb2RlIiwiVG9vbHRpcC5Db250ZW50IiwiVG9vbHRpcC5TaG93T24iLCJUb29sdGlwLmNsb3NlIiwiVG9vbHRpcC4kY29udGFpbnMiLCJUb29sdGlwLlRvb2x0aXAiLCJUb29sdGlwLlRvb2x0aXAuY29uc3RydWN0b3IiLCJUb29sdGlwLlRvb2x0aXAuaW5pdENvbnRlbnQiLCJUb29sdGlwLlRvb2x0aXAudG9nZ2xlIiwiVG9vbHRpcC5Ub29sdGlwLnNob3ciLCJUb29sdGlwLlRvb2x0aXAucG9zaXRpb24iLCJUb29sdGlwLlRvb2x0aXAuY2xvc2UiXSwibWFwcGluZ3MiOiJBQUFBLHlDQUF5QztBQWV6QyxJQUFPLE9BQU8sQ0E0S2I7QUE1S0QsV0FBTyxRQUFPLEVBQUMsQ0FBQztJQUNEQSxzQkFBc0JBLENBQUNBO0lBQ2xDQSxXQUFZQSxJQUFJQTtRQUFHQyxtQ0FBTUE7UUFBRUEsNkJBQUdBO0lBQUNBLENBQUNBLEVBQXBCRCxhQUFJQSxLQUFKQSxhQUFJQSxRQUFnQkE7SUFBaENBLElBQVlBLElBQUlBLEdBQUpBLGFBQW9CQSxDQUFBQTtJQUNoQ0EsV0FBWUEsT0FBT0E7UUFBR0UsdUNBQUtBO1FBQUVBLHFDQUFJQTtJQUFDQSxDQUFDQSxFQUF2QkYsZ0JBQU9BLEtBQVBBLGdCQUFPQSxRQUFnQkE7SUFBbkNBLElBQVlBLE9BQU9BLEdBQVBBLGdCQUF1QkEsQ0FBQUE7SUFDbkNBLFdBQVlBLE1BQU1BO1FBQUdHLHFDQUFLQTtRQUFFQSxxQ0FBS0E7SUFBQ0EsQ0FBQ0EsRUFBdkJILGVBQU1BLEtBQU5BLGVBQU1BLFFBQWlCQTtJQUFuQ0EsSUFBWUEsTUFBTUEsR0FBTkEsZUFBdUJBLENBQUFBO0lBRW5DQSxTQUFTQSxLQUFLQTtRQUNWSSxFQUFFQSxDQUFDQSxDQUFDQSxzQkFBYUEsQ0FBQ0E7WUFDZEEsc0JBQWFBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBO0lBQzlC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LE1BQU1BLENBQUNBO1lBRVhBLEFBQ0FBLDhDQUQ4Q0E7WUFDOUNBLENBQUNBLENBQUNBLFVBQVVBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO1lBRXRCQSxJQUFJQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtZQUV4QkEsSUFBSUEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7WUFDM0JBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLFVBQVVBLEVBQUVBLENBQUNBO1lBQ3ZCQSxJQUFJQSxJQUFJQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxVQUFVQSxFQUFFQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUVwREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsTUFBTUEsQ0FBQ0E7Z0JBQ2RBLElBQUlBLEdBQUdBLE1BQU1BLENBQUNBO1lBQ2xCQSxJQUFJQSxhQUFhQSxHQUFHQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxHQUFHQSxNQUFNQSxDQUFDQSxDQUFDQTtZQUMvQ0EsRUFBRUEsQ0FBQUEsQ0FBQ0EsYUFBYUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2pCQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxHQUFHQSxhQUFhQSxFQUFFQSxNQUFNQSxDQUFDQSxDQUFDQTtZQUVsREEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7Z0JBQ0ZBLE1BQU1BLEVBQUVBLElBQUlBLEdBQUdBLElBQUlBO2dCQUNuQkEsV0FBV0EsRUFBRUEsQ0FBQ0EsRUFBRUEsR0FBR0EsSUFBSUEsR0FBR0EsTUFBTUEsQ0FBQ0EsR0FBR0EsSUFBSUE7YUFDM0NBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQ1ZBLEdBQUdBLENBQUNBLE1BQU1BLEVBQUVBLE1BQU1BLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLFVBQVVBLEVBQUVBLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBO1lBRWpFQSxBQUNBQSx3RUFEd0VBO2dCQUNwRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0E7WUFDeEJBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLFdBQVFBLEdBQ3pCQSxNQUFNQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxRQUFRQSxHQUMzQkEsTUFBTUEsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsV0FBV0EsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsQ0FDOUNBLENBQUNBO1FBQ05BLENBQUNBO1FBRU1MLHVCQUFLQSxHQUFaQTtZQUNJTSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQTtnQkFDZEEsTUFBTUEsQ0FBQ0E7WUFDWEEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsRUFBRUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDckNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO1lBQ3RCQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUNwQkEsc0JBQWFBLEdBQUdBLElBQUlBLENBQUNBO1FBQ3pCQSxDQUFDQTtRQUNMTixjQUFDQTtJQUFEQSxDQXhIQU4sQUF3SENNLElBQUFOO0lBeEhZQSxnQkFBT0EsR0FBUEEsT0F3SFpBLENBQUFBO0FBQ0xBLENBQUNBLEVBNUtNLE9BQU8sS0FBUCxPQUFPLFFBNEtiIiwiZmlsZSI6Im5lYXQtdG9vbHRpcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJ0eXBpbmdzL3RzZC5kLnRzXCIgLz5cclxuXHJcbmludGVyZmFjZSB0b29sdGlwX29wdGlvbnMge1xyXG4gICAgbW9kZT86IFRvb2x0aXAuTW9kZTtcclxuICAgIGNvbnRlbnQ/OiBUb29sdGlwLkNvbnRlbnQ7XHJcbiAgICBjc3NDbGFzcz86IHN0cmluZztcclxuICAgIHNob3dPbj86IFRvb2x0aXAuU2hvd09uO1xyXG4gICAgY2xvc2VTZWxlY3Rvcj86IHN0cmluZztcclxuICAgIGRpc3RhbmNlPzogbnVtYmVyO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgSlF1ZXJ5IHtcclxuICAgIHRvb2x0aXAob3B0aW9ucz86IHRvb2x0aXBfb3B0aW9ucyk6IEpRdWVyeTtcclxufVxyXG5cclxubW9kdWxlIFRvb2x0aXAge1xyXG4gICAgZXhwb3J0IHZhciBhY3RpdmVUb29sdGlwOiBUb29sdGlwO1xyXG4gICAgZXhwb3J0IGVudW0gTW9kZSB7IGJvdHRvbSwgdG9wIH1cclxuICAgIGV4cG9ydCBlbnVtIENvbnRlbnQgeyB0aXRsZSwgaHJlZiB9XHJcbiAgICBleHBvcnQgZW51bSBTaG93T24geyBob3ZlciwgY2xpY2sgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNsb3NlKCkge1xyXG4gICAgICAgIGlmIChhY3RpdmVUb29sdGlwKVxyXG4gICAgICAgICAgICBhY3RpdmVUb29sdGlwLmNsb3NlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy9JbmRpY2F0ZXMgaWYgYSBqcXVlcnkgc2V0IGNvbnRhaW5zIGEgZ2l2ZW4gRE9NIG5vZGVcclxuICAgIGZ1bmN0aW9uICRjb250YWlucygkc2V0OiBKUXVlcnksIGVsZW06IEhUTUxFbGVtZW50LCBpbmNsdWRlU2VsZiA9IHRydWUpIHtcclxuICAgICAgICB2YXIgZTogSlF1ZXJ5ID0gdGhpcztcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGUubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKChpbmNsdWRlU2VsZiAmJiBlLmdldChpKSA9PSBlbGVtKSB8fCAkLmNvbnRhaW5zKGUuZ2V0KGkpLCBlbGVtKSlcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIChmdW5jdGlvbiAoJCkge1xyXG4gICAgICAgICQuZm4udG9vbHRpcCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcblxyXG4gICAgICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe1xyXG4gICAgICAgICAgICAgICAgbW9kZTogTW9kZS5ib3R0b20sXHJcbiAgICAgICAgICAgICAgICBjb250ZW50OiBDb250ZW50LnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgY3NzQ2xhc3M6ICcnLFxyXG4gICAgICAgICAgICAgICAgc2hvd09uOiBTaG93T24uaG92ZXIsXHJcbiAgICAgICAgICAgICAgICBjbG9zZVNlbGVjdG9yOiAnLnRvb2x0aXAtY2xvc2UnLFxyXG4gICAgICAgICAgICAgICAgZGlzdGFuY2U6IDUsXHJcbiAgICAgICAgICAgIH0sIG9wdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdCA9IG5ldyBUb29sdGlwKHRoaXMsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkKCdodG1sJykuY2xpY2soZnVuY3Rpb24gKGV2KSB7XHJcbiAgICAgICAgICAgIC8vSGlkZSB0b29sdGlwIG9uIGNsaWNrIG91dHNpZGUgdGFyZ2V0IGVsZW1lbnQgYW5kIHBvcHVwXHJcbiAgICAgICAgICAgIHZhciAkYWN0aXZlID0gYWN0aXZlVG9vbHRpcC50b29sdGlwLmFkZChhY3RpdmVUb29sdGlwLnRhcmdldCk7XHJcbiAgICAgICAgICAgIGlmIChhY3RpdmVUb29sdGlwICYmICEkY29udGFpbnMoJGFjdGl2ZSwgZXYudGFyZ2V0KSlcclxuICAgICAgICAgICAgICAgIGFjdGl2ZVRvb2x0aXAuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCh3aW5kb3cpLnJlc2l6ZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChhY3RpdmVUb29sdGlwKVxyXG4gICAgICAgICAgICAgICAgYWN0aXZlVG9vbHRpcC5wb3NpdGlvbigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSkoalF1ZXJ5KTtcclxuXHJcbiAgICBleHBvcnQgY2xhc3MgVG9vbHRpcCB7XHJcbiAgICAgICAgcHJpdmF0ZSBjb250ZW50OiBKUXVlcnk7XHJcbiAgICAgICAgcHVibGljIHRvb2x0aXA6IEpRdWVyeTtcclxuICAgICAgICBwdWJsaWMgdGFyZ2V0OiBKUXVlcnk7XHJcblxyXG4gICAgICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdGFyZ2V0RWxlbTogSFRNTEVsZW1lbnQsIHByaXZhdGUgb3B0aW9uczogdG9vbHRpcF9vcHRpb25zKSB7XHJcbiAgICAgICAgICAgIHRhcmdldEVsZW1bJ3Rvb2x0aXAnXSA9IHRoaXM7XHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gJCh0YXJnZXRFbGVtKS5hZGRDbGFzcygnaGFzLXRvb2x0aXAnKTtcclxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuc2hvd09uID09IFNob3dPbi5ob3Zlcikge1xyXG4gICAgICAgICAgICAgICAgLy9SZWFmZmVjdCB0YXJnZXQgdG8gZml4IGJ1ZyBvbiBjbG9uZWQgZWxlbWVudHMuXHJcbiAgICAgICAgICAgICAgICB2YXIgc2hvdyA9IGZ1bmN0aW9uICgpIHsgdGhhdC50YXJnZXQgPSAkKHRoaXMpOyB0aGF0LnNob3coKTsgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0LmhvdmVyKFxyXG4gICAgICAgICAgICAgICAgICAgIHNob3csXHJcbiAgICAgICAgICAgICAgICAgICAgKCkgPT4gdGhpcy5jbG9zZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgKS5jbGljayhzaG93KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0LmNsaWNrKGZ1bmN0aW9uICgpIHsgdGhhdC50YXJnZXQgPSAkKHRoaXMpOyB0aGF0LnRvZ2dsZSgpOyByZXR1cm4gZmFsc2U7fSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgaW5pdENvbnRlbnQoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnQpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY29udGVudCA9PSBDb250ZW50LnRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSB0aGlzLnRhcmdldC5hdHRyKCd0aXRsZScpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aXRsZSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldFxyXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdkYXRhLXRpdGxlJywgdGl0bGUpXHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3RpdGxlJywgJycpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZW50ID0gJCgnPHNwYW4vPicpLmh0bWwodGl0bGUpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZW50ID0gJCh0aGlzLnRhcmdldC5hdHRyKCdocmVmJykpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmNvbnRlbnQubGVuZ3RoKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGVudCA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnQpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnQuZmluZCh0aGlzLm9wdGlvbnMuY2xvc2VTZWxlY3RvcikuY2xpY2soKCkgPT4geyB0aGlzLmNsb3NlKCk7IHJldHVybiBmYWxzZTsgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdG9nZ2xlKCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy50b29sdGlwKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNob3coKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzaG93KCkge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRDb250ZW50KCk7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5jb250ZW50KVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgaWYgKGFjdGl2ZVRvb2x0aXApXHJcbiAgICAgICAgICAgICAgICBhY3RpdmVUb29sdGlwLmNsb3NlKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgZSA9IHRoaXMudGFyZ2V0O1xyXG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcy50b29sdGlwID0gJCgnPGRpdiBjbGFzcz1cInRvb2x0aXAtZnJhbWVcIi8+JylcclxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhvLmNzc0NsYXNzKVxyXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKCd0b29sdGlwLScgKyBNb2RlW28ubW9kZV0pXHJcbiAgICAgICAgICAgICAgICAuYXBwZW5kKHRoaXMuY29udGVudC5zaG93KCkpXHJcbiAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXYgY2xhc3M9XCJ0aXBcIi8+JykpXHJcbiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oJ2JvZHknKTtcclxuXHJcbiAgICAgICAgICAgIGFjdGl2ZVRvb2x0aXAgPSB0aGlzO1xyXG4gICAgICAgICAgICB0aGlzLnBvc2l0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgcG9zaXRpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBtYXJnaW4gPSAxMDtcclxuXHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcy50b29sdGlwO1xyXG4gICAgICAgICAgICB2YXIgZSA9IHRoaXMudGFyZ2V0O1xyXG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgIGlmICghdClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIC8vUmVzZXQgc28gZGltZW50aW9ucyBjYWxjdWxhdGlvbnMgYXJlIGNvcnJlY3RcclxuICAgICAgICAgICAgdC5yZW1vdmVBdHRyKCdzdHlsZScpO1xyXG5cclxuICAgICAgICAgICAgdmFyIG9mZnNldCA9IGUub2Zmc2V0KCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgd3cgPSAkKHdpbmRvdykud2lkdGgoKTtcclxuICAgICAgICAgICAgdmFyIHcgPSB0Lm91dGVyV2lkdGgoKTtcclxuICAgICAgICAgICAgdmFyIGxlZnQgPSBvZmZzZXQubGVmdCArIGUub3V0ZXJXaWR0aCgpIC8gMiAtIHcgLyAyO1xyXG5cclxuICAgICAgICAgICAgaWYgKGxlZnQgPCBtYXJnaW4pXHJcbiAgICAgICAgICAgICAgICBsZWZ0ID0gbWFyZ2luO1xyXG4gICAgICAgICAgICB2YXIgcmlnaHRPdmVyZmxvdyA9IChsZWZ0ICsgdykgLSAod3cgLSBtYXJnaW4pO1xyXG4gICAgICAgICAgICBpZihyaWdodE92ZXJmbG93ID4gMClcclxuICAgICAgICAgICAgICAgIGxlZnQgPSBNYXRoLm1heChsZWZ0IC0gcmlnaHRPdmVyZmxvdywgbWFyZ2luKTtcclxuXHJcbiAgICAgICAgICAgIHQuY3NzKHtcclxuICAgICAgICAgICAgICAgICdsZWZ0JzogbGVmdCArICdweCcsXHJcbiAgICAgICAgICAgICAgICAnbWF4LXdpZHRoJzogKHd3IC0gbGVmdCAtIG1hcmdpbikgKyAncHgnXHJcbiAgICAgICAgICAgIH0pLmZpbmQoJy50aXAnKVxyXG4gICAgICAgICAgICAgICAgLmNzcygnbGVmdCcsIG9mZnNldC5sZWZ0ICsgZS5vdXRlcldpZHRoKCkgLyAyIC0gbGVmdCArICdweCcpO1xyXG5cclxuICAgICAgICAgICAgLy9TZXR0aW5nIHdpZHRoIGNhbiBtYWtlIGhlaWdodCB2YXJ5LiBTbyB3ZSBzZXQgdmVydGljYWwgcG9zaXRpb24gYWZ0ZXIuXHJcbiAgICAgICAgICAgIHZhciBoID0gdC5vdXRlckhlaWdodCgpO1xyXG4gICAgICAgICAgICB0LmNzcygndG9wJywgby5tb2RlID09IE1vZGUudG9wXHJcbiAgICAgICAgICAgICAgICA/IG9mZnNldC50b3AgLSBoIC0gby5kaXN0YW5jZVxyXG4gICAgICAgICAgICAgICAgOiBvZmZzZXQudG9wICsgZS5vdXRlckhlaWdodCgpICsgby5kaXN0YW5jZVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGNsb3NlKCkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMudG9vbHRpcClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50LmhpZGUoKS5hcHBlbmRUbygnYm9keScpO1xyXG4gICAgICAgICAgICB0aGlzLnRvb2x0aXAucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIHRoaXMudG9vbHRpcCA9IG51bGw7XHJcbiAgICAgICAgICAgIGFjdGl2ZVRvb2x0aXAgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==