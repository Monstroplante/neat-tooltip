/// <reference path="typings/tsd.d.ts" />
var Tooltip;
(function (_Tooltip) {
    _Tooltip.activeTooltip;
    (function (Position) {
        Position[Position["bottom"] = 0] = "bottom";
        Position[Position["top"] = 1] = "top";
    })(_Tooltip.Position || (_Tooltip.Position = {}));
    var Position = _Tooltip.Position;
    (function (Source) {
        //Get tooltip content from title attribute
        Source[Source["title"] = 0] = "title";
        // Get tooltip content from href attribute. If href starts with #, will searh for element on the page.
        // Else (not yet supported), will load URL
        Source[Source["href"] = 1] = "href";
    })(_Tooltip.Source || (_Tooltip.Source = {}));
    var Source = _Tooltip.Source;
    (function (ShowOn) {
        ShowOn[ShowOn["hover"] = 0] = "hover";
        ShowOn[ShowOn["click"] = 1] = "click";
    })(_Tooltip.ShowOn || (_Tooltip.ShowOn = {}));
    var ShowOn = _Tooltip.ShowOn;
    function close() {
        if (_Tooltip.activeTooltip)
            _Tooltip.activeTooltip.close();
    }
    //Indicates if a jquery set contains a given DOM node
    function $contains($set, elem, includeSelf) {
        if (includeSelf === void 0) { includeSelf = true; }
        var e = this;
        for (var i = 0; i < e.length; i++) {
            if ((includeSelf && e.get(i) == elem) || $.contains(e.get(i), elem))
                return true;
        }
        return false;
    }
    ;
    (function ($) {
        $.fn.tooltip = function (options) {
            options = $.extend({
                position: 0 /* bottom */,
                source: 0 /* title */,
                cssClass: '',
                showOn: 0 /* hover */,
                closeSelector: '.tooltip-close',
                distance: 5
            }, options);
            return this.each(function () {
                var t = new Tooltip(this, options);
            });
        };
        //Hide tooltip on click outside target element and popup
        $('html').click(function (ev) {
            if (!_Tooltip.activeTooltip)
                return;
            var $active = _Tooltip.activeTooltip.tooltip.add(_Tooltip.activeTooltip.target);
            if (_Tooltip.activeTooltip && !$contains($active, ev.target))
                _Tooltip.activeTooltip.close();
        });
        $(window).resize(function () {
            if (_Tooltip.activeTooltip)
                _Tooltip.activeTooltip.position();
        });
    })(jQuery);
    var Tooltip = (function () {
        function Tooltip(targetElem, options) {
            var _this = this;
            this.targetElem = targetElem;
            this.options = options;
            targetElem['tooltip'] = this;
            this.target = $(targetElem).addClass('has-tooltip');
            var that = this;
            if (options.showOn == 0 /* hover */) {
                //Reaffect target to fix bug on cloned elements.
                var show = function () {
                    that.target = $(this);
                    that.show();
                };
                this.target.hover(show, function () { return _this.close(); }).click(show);
            }
            else {
                this.target.click(function () {
                    that.target = $(this);
                    that.toggle();
                    return false;
                });
            }
        }
        Tooltip.prototype.initContent = function () {
            var _this = this;
            if (this.content)
                return;
            if (this.options.source == 0 /* title */) {
                var title = this.target.attr('title');
                if (!title)
                    return;
                this.target.attr('data-title', title).attr('title', '');
                this.content = $('<span/>').html(title);
            }
            else if (this.options.source == 1 /* href */) {
                this.content = $(this.target.attr('href'));
                if (!this.content.length)
                    this.content = null;
            }
            if (this.content)
                this.content.find(this.options.closeSelector).click(function () {
                    _this.close();
                    return false;
                });
        };
        Tooltip.prototype.toggle = function () {
            if (this.tooltip)
                this.close();
            else
                this.show();
        };
        Tooltip.prototype.show = function () {
            this.initContent();
            if (!this.content)
                return;
            if (_Tooltip.activeTooltip)
                _Tooltip.activeTooltip.close();
            var e = this.target;
            var o = this.options;
            var t = this.tooltip = $('<div class="tooltip-frame"/>').addClass(o.cssClass).addClass('tooltip-' + Position[o.position]).append(this.content.show()).append($('<div class="tip"/>')).appendTo('body');
            _Tooltip.activeTooltip = this;
            this.position();
        };
        Tooltip.prototype.position = function () {
            var margin = 10;
            var t = this.tooltip;
            var e = this.target;
            var o = this.options;
            if (!t)
                return;
            //Reset so dimentions calculations are correct
            t.removeAttr('style');
            var offset = e.offset();
            var ww = $(window).width();
            var w = t.outerWidth();
            var left = offset.left + e.outerWidth() / 2 - w / 2;
            if (left < margin)
                left = margin;
            var rightOverflow = (left + w) - (ww - margin);
            if (rightOverflow > 0)
                left = Math.max(left - rightOverflow, margin);
            t.css({
                'left': left + 'px',
                'max-width': (ww - left - margin) + 'px'
            }).find('.tip').css('left', offset.left + e.outerWidth() / 2 - left + 'px');
            //Setting width can make height vary. So we set vertical position after.
            var h = t.outerHeight();
            t.css('top', o.position == 1 /* top */ ? offset.top - h - o.distance : offset.top + e.outerHeight() + o.distance);
        };
        Tooltip.prototype.close = function () {
            if (!this.tooltip)
                return;
            this.content.hide().appendTo('body');
            this.tooltip.remove();
            this.tooltip = null;
            _Tooltip.activeTooltip = null;
        };
        return Tooltip;
    })();
    _Tooltip.Tooltip = Tooltip;
})(Tooltip || (Tooltip = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5lYXQtdG9vbHRpcC50cyJdLCJuYW1lcyI6WyJUb29sdGlwIiwiVG9vbHRpcC5Qb3NpdGlvbiIsIlRvb2x0aXAuU291cmNlIiwiVG9vbHRpcC5TaG93T24iLCJUb29sdGlwLmNsb3NlIiwiVG9vbHRpcC4kY29udGFpbnMiLCJUb29sdGlwLlRvb2x0aXAiLCJUb29sdGlwLlRvb2x0aXAuY29uc3RydWN0b3IiLCJUb29sdGlwLlRvb2x0aXAuaW5pdENvbnRlbnQiLCJUb29sdGlwLlRvb2x0aXAudG9nZ2xlIiwiVG9vbHRpcC5Ub29sdGlwLnNob3ciLCJUb29sdGlwLlRvb2x0aXAucG9zaXRpb24iLCJUb29sdGlwLlRvb2x0aXAuY2xvc2UiXSwibWFwcGluZ3MiOiJBQUFBLHlDQUF5QztBQWV6QyxJQUFPLE9BQU8sQ0FvTGI7QUFwTEQsV0FBTyxRQUFPLEVBQUMsQ0FBQztJQUNEQSxzQkFBc0JBLENBQUNBO0lBQ2xDQSxXQUFZQSxRQUFRQTtRQUFHQywyQ0FBTUE7UUFBRUEscUNBQUdBO0lBQUNBLENBQUNBLEVBQXhCRCxpQkFBUUEsS0FBUkEsaUJBQVFBLFFBQWdCQTtJQUFwQ0EsSUFBWUEsUUFBUUEsR0FBUkEsaUJBQXdCQSxDQUFBQTtJQUNwQ0EsV0FBWUEsTUFBTUE7UUFDZEUsMENBQTBDQTtRQUMxQ0EscUNBQUtBO1FBQ0xBLHNHQUFzR0E7UUFDdEdBLDBDQUEwQ0E7UUFDMUNBLG1DQUFJQTtJQUNSQSxDQUFDQSxFQU5XRixlQUFNQSxLQUFOQSxlQUFNQSxRQU1qQkE7SUFOREEsSUFBWUEsTUFBTUEsR0FBTkEsZUFNWEEsQ0FBQUE7SUFDREEsV0FBWUEsTUFBTUE7UUFBR0cscUNBQUtBO1FBQUVBLHFDQUFLQTtJQUFDQSxDQUFDQSxFQUF2QkgsZUFBTUEsS0FBTkEsZUFBTUEsUUFBaUJBO0lBQW5DQSxJQUFZQSxNQUFNQSxHQUFOQSxlQUF1QkEsQ0FBQUE7SUFFbkNBLFNBQVNBLEtBQUtBO1FBQ1ZJLEVBQUVBLENBQUNBLENBQUNBLHNCQUFhQSxDQUFD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QUNBO0lBQURBLENBeEhBTixBQXdIQ00sSUFBQU47SUF4SFlBLGdCQUFPQSxHQUFQQSxPQXdIWkEsQ0FBQUE7QUFDTEEsQ0FBQ0EsRUFwTE0sT0FBTyxLQUFQLE9BQU8sUUFvTGIiLCJmaWxlIjoibmVhdC10b29sdGlwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cInR5cGluZ3MvdHNkLmQudHNcIiAvPlxyXG5cclxuaW50ZXJmYWNlIHRvb2x0aXBfb3B0aW9ucyB7XHJcbiAgICBwb3NpdGlvbj86IFRvb2x0aXAuUG9zaXRpb247XHJcbiAgICBzb3VyY2U/OiBUb29sdGlwLlNvdXJjZTtcclxuICAgIGNzc0NsYXNzPzogc3RyaW5nO1xyXG4gICAgc2hvd09uPzogVG9vbHRpcC5TaG93T247XHJcbiAgICBjbG9zZVNlbGVjdG9yPzogc3RyaW5nO1xyXG4gICAgZGlzdGFuY2U/OiBudW1iZXI7XHJcbn1cclxuXHJcbmludGVyZmFjZSBKUXVlcnkge1xyXG4gICAgdG9vbHRpcChvcHRpb25zPzogdG9vbHRpcF9vcHRpb25zKTogSlF1ZXJ5O1xyXG59XHJcblxyXG5tb2R1bGUgVG9vbHRpcCB7XHJcbiAgICBleHBvcnQgdmFyIGFjdGl2ZVRvb2x0aXA6IFRvb2x0aXA7XHJcbiAgICBleHBvcnQgZW51bSBQb3NpdGlvbiB7IGJvdHRvbSwgdG9wIH1cclxuICAgIGV4cG9ydCBlbnVtIFNvdXJjZSB7XHJcbiAgICAgICAgLy9HZXQgdG9vbHRpcCBjb250ZW50IGZyb20gdGl0bGUgYXR0cmlidXRlXHJcbiAgICAgICAgdGl0bGUsXHJcbiAgICAgICAgLy8gR2V0IHRvb2x0aXAgY29udGVudCBmcm9tIGhyZWYgYXR0cmlidXRlLiBJZiBocmVmIHN0YXJ0cyB3aXRoICMsIHdpbGwgc2VhcmggZm9yIGVsZW1lbnQgb24gdGhlIHBhZ2UuXHJcbiAgICAgICAgLy8gRWxzZSAobm90IHlldCBzdXBwb3J0ZWQpLCB3aWxsIGxvYWQgVVJMXHJcbiAgICAgICAgaHJlZlxyXG4gICAgfVxyXG4gICAgZXhwb3J0IGVudW0gU2hvd09uIHsgaG92ZXIsIGNsaWNrIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjbG9zZSgpIHtcclxuICAgICAgICBpZiAoYWN0aXZlVG9vbHRpcClcclxuICAgICAgICAgICAgYWN0aXZlVG9vbHRpcC5jbG9zZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vSW5kaWNhdGVzIGlmIGEganF1ZXJ5IHNldCBjb250YWlucyBhIGdpdmVuIERPTSBub2RlXHJcbiAgICBmdW5jdGlvbiAkY29udGFpbnMoJHNldDogSlF1ZXJ5LCBlbGVtOiBIVE1MRWxlbWVudCwgaW5jbHVkZVNlbGYgPSB0cnVlKSB7XHJcbiAgICAgICAgdmFyIGU6IEpRdWVyeSA9IHRoaXM7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICgoaW5jbHVkZVNlbGYgJiYgZS5nZXQoaSkgPT0gZWxlbSkgfHwgJC5jb250YWlucyhlLmdldChpKSwgZWxlbSkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuXHJcbiAgICAoZnVuY3Rpb24gKCQpIHtcclxuICAgICAgICAkLmZuLnRvb2x0aXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG5cclxuICAgICAgICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBQb3NpdGlvbi5ib3R0b20sXHJcbiAgICAgICAgICAgICAgICBzb3VyY2U6IFNvdXJjZS50aXRsZSxcclxuICAgICAgICAgICAgICAgIGNzc0NsYXNzOiAnJyxcclxuICAgICAgICAgICAgICAgIHNob3dPbjogU2hvd09uLmhvdmVyLFxyXG4gICAgICAgICAgICAgICAgY2xvc2VTZWxlY3RvcjogJy50b29sdGlwLWNsb3NlJyxcclxuICAgICAgICAgICAgICAgIGRpc3RhbmNlOiA1LFxyXG4gICAgICAgICAgICB9LCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHQgPSBuZXcgVG9vbHRpcCh0aGlzLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9IaWRlIHRvb2x0aXAgb24gY2xpY2sgb3V0c2lkZSB0YXJnZXQgZWxlbWVudCBhbmQgcG9wdXBcclxuICAgICAgICAkKCdodG1sJykuY2xpY2soZnVuY3Rpb24gKGV2KSB7XHJcbiAgICAgICAgICAgIGlmKCFhY3RpdmVUb29sdGlwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB2YXIgJGFjdGl2ZSA9IGFjdGl2ZVRvb2x0aXAudG9vbHRpcC5hZGQoYWN0aXZlVG9vbHRpcC50YXJnZXQpO1xyXG4gICAgICAgICAgICBpZiAoYWN0aXZlVG9vbHRpcCAmJiAhJGNvbnRhaW5zKCRhY3RpdmUsIGV2LnRhcmdldCkpXHJcbiAgICAgICAgICAgICAgICBhY3RpdmVUb29sdGlwLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICQod2luZG93KS5yZXNpemUoKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoYWN0aXZlVG9vbHRpcClcclxuICAgICAgICAgICAgICAgIGFjdGl2ZVRvb2x0aXAucG9zaXRpb24oKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pKGpRdWVyeSk7XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIFRvb2x0aXAge1xyXG4gICAgICAgIHByaXZhdGUgY29udGVudDogSlF1ZXJ5O1xyXG4gICAgICAgIHB1YmxpYyB0b29sdGlwOiBKUXVlcnk7XHJcbiAgICAgICAgcHVibGljIHRhcmdldDogSlF1ZXJ5O1xyXG5cclxuICAgICAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHRhcmdldEVsZW06IEhUTUxFbGVtZW50LCBwcml2YXRlIG9wdGlvbnM6IHRvb2x0aXBfb3B0aW9ucykge1xyXG4gICAgICAgICAgICB0YXJnZXRFbGVtWyd0b29sdGlwJ10gPSB0aGlzO1xyXG4gICAgICAgICAgICB0aGlzLnRhcmdldCA9ICQodGFyZ2V0RWxlbSkuYWRkQ2xhc3MoJ2hhcy10b29sdGlwJyk7XHJcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnNob3dPbiA9PSBTaG93T24uaG92ZXIpIHtcclxuICAgICAgICAgICAgICAgIC8vUmVhZmZlY3QgdGFyZ2V0IHRvIGZpeCBidWcgb24gY2xvbmVkIGVsZW1lbnRzLlxyXG4gICAgICAgICAgICAgICAgdmFyIHNob3cgPSBmdW5jdGlvbiAoKSB7IHRoYXQudGFyZ2V0ID0gJCh0aGlzKTsgdGhhdC5zaG93KCk7IH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldC5ob3ZlcihcclxuICAgICAgICAgICAgICAgICAgICBzaG93LFxyXG4gICAgICAgICAgICAgICAgICAgICgpID0+IHRoaXMuY2xvc2UoKVxyXG4gICAgICAgICAgICAgICAgICAgICkuY2xpY2soc2hvdyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldC5jbGljayhmdW5jdGlvbiAoKSB7IHRoYXQudGFyZ2V0ID0gJCh0aGlzKTsgdGhhdC50b2dnbGUoKTsgcmV0dXJuIGZhbHNlO30pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGluaXRDb250ZW50KCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb250ZW50KVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNvdXJjZSA9PSBTb3VyY2UudGl0bGUpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0aXRsZSA9IHRoaXMudGFyZ2V0LmF0dHIoJ3RpdGxlJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRpdGxlKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0XHJcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2RhdGEtdGl0bGUnLCB0aXRsZSlcclxuICAgICAgICAgICAgICAgICAgICAuYXR0cigndGl0bGUnLCAnJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSAkKCc8c3Bhbi8+JykuaHRtbCh0aXRsZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZih0aGlzLm9wdGlvbnMuc291cmNlID09IFNvdXJjZS5ocmVmKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGVudCA9ICQodGhpcy50YXJnZXQuYXR0cignaHJlZicpKTtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5jb250ZW50Lmxlbmd0aClcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5jb250ZW50KVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZW50LmZpbmQodGhpcy5vcHRpb25zLmNsb3NlU2VsZWN0b3IpLmNsaWNrKCgpID0+IHsgdGhpcy5jbG9zZSgpOyByZXR1cm4gZmFsc2U7IH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHRvZ2dsZSgpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMudG9vbHRpcClcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zaG93KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc2hvdygpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0Q29udGVudCgpO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuY29udGVudClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIGlmIChhY3RpdmVUb29sdGlwKVxyXG4gICAgICAgICAgICAgICAgYWN0aXZlVG9vbHRpcC5jbG9zZSgpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGUgPSB0aGlzLnRhcmdldDtcclxuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLm9wdGlvbnM7XHJcblxyXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMudG9vbHRpcCA9ICQoJzxkaXYgY2xhc3M9XCJ0b29sdGlwLWZyYW1lXCIvPicpXHJcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3Moby5jc3NDbGFzcylcclxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcygndG9vbHRpcC0nICsgUG9zaXRpb25bby5wb3NpdGlvbl0pXHJcbiAgICAgICAgICAgICAgICAuYXBwZW5kKHRoaXMuY29udGVudC5zaG93KCkpXHJcbiAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXYgY2xhc3M9XCJ0aXBcIi8+JykpXHJcbiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oJ2JvZHknKTtcclxuXHJcbiAgICAgICAgICAgIGFjdGl2ZVRvb2x0aXAgPSB0aGlzO1xyXG4gICAgICAgICAgICB0aGlzLnBvc2l0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgcG9zaXRpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBtYXJnaW4gPSAxMDtcclxuXHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcy50b29sdGlwO1xyXG4gICAgICAgICAgICB2YXIgZSA9IHRoaXMudGFyZ2V0O1xyXG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgIGlmICghdClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIC8vUmVzZXQgc28gZGltZW50aW9ucyBjYWxjdWxhdGlvbnMgYXJlIGNvcnJlY3RcclxuICAgICAgICAgICAgdC5yZW1vdmVBdHRyKCdzdHlsZScpO1xyXG5cclxuICAgICAgICAgICAgdmFyIG9mZnNldCA9IGUub2Zmc2V0KCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgd3cgPSAkKHdpbmRvdykud2lkdGgoKTtcclxuICAgICAgICAgICAgdmFyIHcgPSB0Lm91dGVyV2lkdGgoKTtcclxuICAgICAgICAgICAgdmFyIGxlZnQgPSBvZmZzZXQubGVmdCArIGUub3V0ZXJXaWR0aCgpIC8gMiAtIHcgLyAyO1xyXG5cclxuICAgICAgICAgICAgaWYgKGxlZnQgPCBtYXJnaW4pXHJcbiAgICAgICAgICAgICAgICBsZWZ0ID0gbWFyZ2luO1xyXG4gICAgICAgICAgICB2YXIgcmlnaHRPdmVyZmxvdyA9IChsZWZ0ICsgdykgLSAod3cgLSBtYXJnaW4pO1xyXG4gICAgICAgICAgICBpZihyaWdodE92ZXJmbG93ID4gMClcclxuICAgICAgICAgICAgICAgIGxlZnQgPSBNYXRoLm1heChsZWZ0IC0gcmlnaHRPdmVyZmxvdywgbWFyZ2luKTtcclxuXHJcbiAgICAgICAgICAgIHQuY3NzKHtcclxuICAgICAgICAgICAgICAgICdsZWZ0JzogbGVmdCArICdweCcsXHJcbiAgICAgICAgICAgICAgICAnbWF4LXdpZHRoJzogKHd3IC0gbGVmdCAtIG1hcmdpbikgKyAncHgnXHJcbiAgICAgICAgICAgIH0pLmZpbmQoJy50aXAnKVxyXG4gICAgICAgICAgICAgICAgLmNzcygnbGVmdCcsIG9mZnNldC5sZWZ0ICsgZS5vdXRlcldpZHRoKCkgLyAyIC0gbGVmdCArICdweCcpO1xyXG5cclxuICAgICAgICAgICAgLy9TZXR0aW5nIHdpZHRoIGNhbiBtYWtlIGhlaWdodCB2YXJ5LiBTbyB3ZSBzZXQgdmVydGljYWwgcG9zaXRpb24gYWZ0ZXIuXHJcbiAgICAgICAgICAgIHZhciBoID0gdC5vdXRlckhlaWdodCgpO1xyXG4gICAgICAgICAgICB0LmNzcygndG9wJywgby5wb3NpdGlvbiA9PSBQb3NpdGlvbi50b3BcclxuICAgICAgICAgICAgICAgID8gb2Zmc2V0LnRvcCAtIGggLSBvLmRpc3RhbmNlXHJcbiAgICAgICAgICAgICAgICA6IG9mZnNldC50b3AgKyBlLm91dGVySGVpZ2h0KCkgKyBvLmRpc3RhbmNlXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgY2xvc2UoKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy50b29sdGlwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQuaGlkZSgpLmFwcGVuZFRvKCdib2R5Jyk7XHJcbiAgICAgICAgICAgIHRoaXMudG9vbHRpcC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy50b29sdGlwID0gbnVsbDtcclxuICAgICAgICAgICAgYWN0aXZlVG9vbHRpcCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9