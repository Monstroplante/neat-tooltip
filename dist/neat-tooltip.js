/// <reference path="typings/tsd.d.ts" />
var Tooltip;
(function (_Tooltip) {
    var active;
    var close = function () {
        if (active)
            active.close();
    };
    $.tooltip = function (action) {
        switch (action) {
            case 'close':
                close();
                break;
            case 'get': return active;
            case 'position':
                if (active)
                    active.position();
                break;
            default: throw 'Not supported action ' + action;
        }
    };
    //Indicates if a jquery set contains a given DOM node
    function $contains(e, elem, includeSelf) {
        if (includeSelf === void 0) { includeSelf = true; }
        for (var i = 0; i < e.length; i++) {
            if ((includeSelf && e.get(i) == elem) || $.contains(e.get(i), elem))
                return true;
        }
        return false;
    }
    ;
    (function ($) {
        //Display a tooltip once
        $.fn.showTooltip = function (options) {
            if (this.length)
                new Tooltip(this.eq(0), options);
        };
        //Display a tooltip once
        $.fn.closeTooltip = function (options) {
            return this.each(function () {
                var t = $(this).data('_tooltip');
                if (t)
                    t.close();
            });
        };
        //Bind tooltip display to event
        $.fn.tooltip = function (options, showOn, selector) {
            if (showOn === void 0) { showOn = 'hover'; }
            if (showOn == 'hover') {
                var show = function () {
                    $(this).showTooltip(options);
                };
                this.on('mouseenter', selector, show).on('mouseleave', selector, function () {
                    $(this).closeTooltip();
                }).on('click', selector, show);
            }
            else if (showOn == 'click') {
                this.on('click', selector, function () {
                    var e = $(this);
                    if (e.data('_tooltip'))
                        e.closeTooltip();
                    else
                        e.showTooltip(options);
                    return false;
                });
            }
            else {
                throw 'This value is not supported for argument showOn: ' + showOn;
            }
            return this;
        };
        //Hide tooltip on click outside target element and popup
        $('html').click(function (ev) {
            var t = active;
            if (t && t.options.closeOnClickOuside && !$contains(t.tooltip.add(t.target), ev.target))
                t.close();
        });
        $(window).resize(function () {
            $.tooltip('position');
        });
    })(jQuery);
    var Tooltip = (function () {
        function Tooltip(targetElem, options) {
            var _this = this;
            this.targetElem = targetElem;
            this.options = options;
            this.closeCallback = function () {
                _this.close();
                return false;
            };
            this.options = $.extend({
                position: 'bottom',
                source: 'title',
                cssClass: '',
                closeSelector: '.tooltip-close',
                distance: 5,
                closeOnClickOuside: true,
                delay: 200,
                container: window,
                margin: 10,
                appendTo: 'body'
            }, options);
            this.target = $(targetElem).addClass('has-tooltip').data('_tooltip', this);
            this.showTimeout = setTimeout(function () { return _this.show(); }, this.options.delay);
        }
        Tooltip.prototype.getContent = function () {
            var c = this.options.content;
            if (c) {
                c = $.isFunction(c) ? c.call(this.target) : c;
                return !c ? null : typeof c == 'string' ? $('<div>').html(c) : $(c);
            }
            if (this.options.source == 'title') {
                var title = this.target.attr('title') || this.target.data('title');
                this.target.attr('title', '').data('title', title);
                return $('<div>').html(title);
            }
            if (this.options.source == 'anchor') {
                var content = $(this.target.attr('href'));
                return content.length ? content : null;
            }
        };
        Tooltip.prototype.show = function () {
            this.content = this.getContent();
            if (!this.content)
                return;
            close();
            this.content.off('click', this.closeCallback).on('click', this.options.closeSelector, this.closeCallback);
            var o = this.options;
            var appendTo = $(this.options.appendTo).first();
            this.tooltip = $('<div class="tooltip-frame"/>').addClass(o.cssClass).addClass('tooltip-' + o.position).append(this.content.show()).append($('<div class="tip"/>')).appendTo(appendTo);
            if (appendTo.css('position') == 'static')
                appendTo.css('position', 'relative');
            this.target.data('_tooltip', this);
            this.position();
            active = this;
        };
        Tooltip.prototype.position = function () {
            var margin = this.options.margin;
            var t = this.tooltip;
            var e = this.target;
            var o = this.options;
            if (!t)
                return;
            //Reset so dimentions calculations are correct
            t.removeAttr('style');
            var offset = e.offset();
            var container = this.options.container;
            var containerLeft = container === window ? 0 : $(container).offset().left;
            var minLeft = containerLeft + margin;
            var maxRight = (containerLeft + $(container).outerWidth()) - margin;
            var w = t.outerWidth();
            var left = Math.max(minLeft, offset.left + e.outerWidth() / 2 - w / 2);
            var rightOverflow = (left + w) - maxRight;
            if (rightOverflow > 0)
                left = Math.max(minLeft, left - rightOverflow);
            var parentOffset = t.parent().offset();
            t.css({
                'left': (left - parentOffset.left) + 'px',
                'max-width': (maxRight - left) + 'px'
            }).find('.tip').css('left', offset.left + e.outerWidth() / 2 - left + 'px');
            //Setting width can make height vary. So we set vertical position after.
            var h = t.outerHeight();
            t.css('top', (o.position == 'top' ? offset.top - h - o.distance : offset.top + e.outerHeight() + o.distance) - parentOffset.top);
        };
        Tooltip.prototype.close = function () {
            clearTimeout(this.showTimeout);
            if (!this.tooltip)
                return;
            if (this.options.source == 'anchor')
                this.content.hide().appendTo('body');
            this.tooltip.remove();
            this.tooltip = null;
            this.target.data('_tooltip', null);
            active = null;
        };
        return Tooltip;
    })();
    _Tooltip.Tooltip = Tooltip;
})(Tooltip || (Tooltip = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5lYXQtdG9vbHRpcC50cyJdLCJuYW1lcyI6WyJUb29sdGlwIiwiVG9vbHRpcC4kY29udGFpbnMiLCJUb29sdGlwLlRvb2x0aXAiLCJUb29sdGlwLlRvb2x0aXAuY29uc3RydWN0b3IiLCJUb29sdGlwLlRvb2x0aXAuZ2V0Q29udGVudCIsIlRvb2x0aXAuVG9vbHRpcC5zaG93IiwiVG9vbHRpcC5Ub29sdGlwLnBvc2l0aW9uIiwiVG9vbHRpcC5Ub29sdGlwLmNsb3NlIl0sIm1hcHBpbmdzIjoiQUFBQSx5Q0FBeUM7QUFJekMsSUFBTyxPQUFPLENBME1iO0FBMU1ELFdBQU8sUUFBTyxFQUFDLENBQUM7SUFDWkEsSUFBSUEsTUFBZUEsQ0FBQ0E7SUFFcEJBLElBQUlBLEtBQUtBLEdBQUdBO1FBQ1IsRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDO1lBQ04sTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQ0E7SUFFRkEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsR0FBR0EsVUFBU0EsTUFBY0E7UUFDL0IsTUFBTSxDQUFBLENBQUMsTUFBTSxDQUFDLENBQUEsQ0FBQztZQUNYLEtBQUssT0FBTztnQkFBRyxLQUFLLEVBQUUsQ0FBQztnQkFBQyxLQUFLLENBQUM7WUFDOUIsS0FBSyxLQUFLLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQztZQUMxQixLQUFLLFVBQVU7Z0JBQUUsRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDO29CQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFBQyxLQUFLLENBQUM7WUFDckQsU0FBUyxNQUFNLHVCQUF1QixHQUFHLE1BQU0sQ0FBQztRQUNwRCxDQUFDO0lBQ0wsQ0FBQyxDQUFDQTtJQUVGQSxBQUNBQSxxREFEcURBO2FBQzVDQSxTQUFTQSxDQUFDQSxDQUFTQSxFQUFFQSxJQUFpQkEsRUFBRUEsV0FBa0JBO1FBQWxCQywyQkFBa0JBLEdBQWxCQSxrQkFBa0JBO1FBQy9EQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxD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Q0FBQ0EsTUFBTUEsSUFBSUEsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2pDQSxJQUFJQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtnQkFDbkVBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO2dCQUNuREEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFDbENBLENBQUNBO1lBQ0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLElBQUlBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO2dCQUNsQ0EsSUFBSUEsT0FBT0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzFDQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxHQUFHQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUMzQ0EsQ0FBQ0E7UUFDTEEsQ0FBQ0E7UUFFT0Ysc0JBQUlBLEdBQVpBO1lBQ0lHLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBLFVBQVVBLEVBQUVBLENBQUNBO1lBQ2pDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQTtnQkFDZEEsTUFBTUEsQ0FBQ0E7WUFFWEEsS0FBS0EsRUFBRUEsQ0FBQ0E7WUFFUkEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FDUEEsR0FBR0EsQ0FBQ0EsT0FBT0EsRUFBRUEsSUFBSUEsQ0FB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R0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFFdkVBLElBQUlBLGFBQWFBLEdBQUdBLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLFFBQVFBLENBQUNBO1lBQzFDQSxFQUFFQSxDQUFBQSxDQUFDQSxhQUFhQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFDakJBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLE9BQU9BLEVBQUVBLElBQUlBLEdBQUdBLGFBQWFBLENBQUNBLENBQUFBO1lBRWxEQSxJQUFJQSxZQUFZQSxHQUFHQSxDQUFDQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtZQUN2Q0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0E7Z0JBQ0ZBLE1BQU1BLEVBQUVBLENBQUNBLElBQUlBLEdBQUdBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLElBQUlBO2dCQUN6Q0EsV0FBV0EsRUFBRUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsSUFBSUE7YUFDeENBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLEVBQUVBLE1BQU1BLENBQUNBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBLFVBQVVBLEVBQUVBLEdBQUdBLENBQUNBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBO1lBQzVFQSxBQUNBQSx3RUFEd0VBO2dCQUNwRUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0E7WUFDeEJBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLFFBQVFBLElBQUlBLEtBQUtBLEdBQUdBLE1BQU1BLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLFFBQVFBLEdBQUdBLE1BQU1BLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBLFdBQVdBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLFlBQVlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3JJQSxDQUFDQTtRQUVNSix1QkFBS0EsR0FBWkE7WUFDSUssWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0E7WUFDL0JBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBO2dCQUNkQSxNQUFNQSxDQUFDQTtZQUNYQSxFQUFFQSxDQUFBQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxJQUFJQSxRQUFRQSxDQUFDQTtnQkFDL0JBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1lBQ3pDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtZQUN0QkEsSUFBSUEsQ0FBQ0EsT0FBT0EsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDcEJBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1lBQ25DQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUNsQkEsQ0FBQ0E7UUFDTEwsY0FBQ0E7SUFBREEsQ0F6SEFGLEFBeUhDRSxJQUFBRjtJQXpIWUEsZ0JBQU9BLEdBQVBBLE9BeUhaQSxDQUFBQTtBQUNMQSxDQUFDQSxFQTFNTSxPQUFPLEtBQVAsT0FBTyxRQTBNYiIsImZpbGUiOiJuZWF0LXRvb2x0aXAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwidHlwaW5ncy90c2QuZC50c1wiIC8+XHJcblxyXG5cclxuXHJcbm1vZHVsZSBUb29sdGlwIHtcclxuICAgIHZhciBhY3RpdmU6IFRvb2x0aXA7XHJcblxyXG4gICAgdmFyIGNsb3NlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICBpZihhY3RpdmUpXHJcbiAgICAgICAgICAgIGFjdGl2ZS5jbG9zZSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICAkLnRvb2x0aXAgPSBmdW5jdGlvbihhY3Rpb246IHN0cmluZyl7XHJcbiAgICAgICAgc3dpdGNoKGFjdGlvbil7XHJcbiAgICAgICAgICAgIGNhc2UgJ2Nsb3NlJyA6IGNsb3NlKCk7IGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdnZXQnOiByZXR1cm4gYWN0aXZlO1xyXG4gICAgICAgICAgICBjYXNlICdwb3NpdGlvbic6IGlmKGFjdGl2ZSkgYWN0aXZlLnBvc2l0aW9uKCk7IGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OiB0aHJvdyAnTm90IHN1cHBvcnRlZCBhY3Rpb24gJyArIGFjdGlvbjtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vSW5kaWNhdGVzIGlmIGEganF1ZXJ5IHNldCBjb250YWlucyBhIGdpdmVuIERPTSBub2RlXHJcbiAgICBmdW5jdGlvbiAkY29udGFpbnMoZTogSlF1ZXJ5LCBlbGVtOiBIVE1MRWxlbWVudCwgaW5jbHVkZVNlbGYgPSB0cnVlKSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICgoaW5jbHVkZVNlbGYgJiYgZS5nZXQoaSkgPT0gZWxlbSkgfHwgJC5jb250YWlucyhlLmdldChpKSwgZWxlbSkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuXHJcbiAgICAoZnVuY3Rpb24gKCQpIHtcclxuXHJcbiAgICAgICAgLy9EaXNwbGF5IGEgdG9vbHRpcCBvbmNlXHJcbiAgICAgICAgJC5mbi5zaG93VG9vbHRpcCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgICAgIGlmKHRoaXMubGVuZ3RoKVxyXG4gICAgICAgICAgICAgICAgbmV3IFRvb2x0aXAodGhpcy5lcSgwKSwgb3B0aW9ucyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9EaXNwbGF5IGEgdG9vbHRpcCBvbmNlXHJcbiAgICAgICAgJC5mbi5jbG9zZVRvb2x0aXAgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgdCA9IDxUb29sdGlwPiQodGhpcykuZGF0YSgnX3Rvb2x0aXAnKTtcclxuICAgICAgICAgICAgICAgIGlmKHQpXHJcbiAgICAgICAgICAgICAgICAgICAgdC5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL0JpbmQgdG9vbHRpcCBkaXNwbGF5IHRvIGV2ZW50XHJcbiAgICAgICAgJC5mbi50b29sdGlwID0gZnVuY3Rpb24gKG9wdGlvbnMsIHNob3dPbiA9ICdob3ZlcicsIHNlbGVjdG9yPzpzdHJpbmcpIHtcclxuICAgICAgICAgICAgaWYgKHNob3dPbiA9PSAnaG92ZXInKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2hvdyA9IGZ1bmN0aW9uICgpIHsgJCh0aGlzKS5zaG93VG9vbHRpcChvcHRpb25zKSB9O1xyXG4gICAgICAgICAgICAgICAgdGhpc1xyXG4gICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VlbnRlcicsIHNlbGVjdG9yLCBzaG93KVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VsZWF2ZScsIHNlbGVjdG9yLCBmdW5jdGlvbigpeyQodGhpcykuY2xvc2VUb29sdGlwKCk7fSlcclxuICAgICAgICAgICAgICAgICAgICAub24oJ2NsaWNrJywgc2VsZWN0b3IsIHNob3cpO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChzaG93T24gPT0gJ2NsaWNrJyl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uKCdjbGljaycsIHNlbGVjdG9yLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGUuZGF0YSgnX3Rvb2x0aXAnKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5jbG9zZVRvb2x0aXAoKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUuc2hvd1Rvb2x0aXAob3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgJ1RoaXMgdmFsdWUgaXMgbm90IHN1cHBvcnRlZCBmb3IgYXJndW1lbnQgc2hvd09uOiAnICsgc2hvd09uO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL0hpZGUgdG9vbHRpcCBvbiBjbGljayBvdXRzaWRlIHRhcmdldCBlbGVtZW50IGFuZCBwb3B1cFxyXG4gICAgICAgICQoJ2h0bWwnKS5jbGljayhmdW5jdGlvbiAoZXYpIHtcclxuICAgICAgICAgICAgdmFyIHQgPSBhY3RpdmU7XHJcbiAgICAgICAgICAgIGlmICh0ICYmIHQub3B0aW9ucy5jbG9zZU9uQ2xpY2tPdXNpZGUgJiYgISRjb250YWlucyh0LnRvb2x0aXAuYWRkKHQudGFyZ2V0KSwgZXYudGFyZ2V0KSlcclxuICAgICAgICAgICAgICAgIHQuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJCh3aW5kb3cpLnJlc2l6ZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICQudG9vbHRpcCgncG9zaXRpb24nKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pKGpRdWVyeSk7XHJcblxyXG4gICAgZXhwb3J0IGNsYXNzIFRvb2x0aXAge1xyXG4gICAgICAgIHB1YmxpYyB0b29sdGlwOiBKUXVlcnk7XHJcbiAgICAgICAgcHVibGljIHRhcmdldDogSlF1ZXJ5O1xyXG4gICAgICAgIHB1YmxpYyBjb250ZW50OiBKUXVlcnk7XHJcbiAgICAgICAgcHJpdmF0ZSBjbG9zZUNhbGxiYWNrID0gKCkgPT4geyB0aGlzLmNsb3NlKCk7IHJldHVybiBmYWxzZTsgfTtcclxuICAgICAgICBwcml2YXRlIHNob3dUaW1lb3V0O1xyXG5cclxuICAgICAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHRhcmdldEVsZW06IEhUTUxFbGVtZW50LCBwdWJsaWMgb3B0aW9uczogdG9vbHRpcF9vcHRpb25zKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnYm90dG9tJyxcclxuICAgICAgICAgICAgICAgIHNvdXJjZTogJ3RpdGxlJyxcclxuICAgICAgICAgICAgICAgIGNzc0NsYXNzOiAnJyxcclxuICAgICAgICAgICAgICAgIGNsb3NlU2VsZWN0b3I6ICcudG9vbHRpcC1jbG9zZScsXHJcbiAgICAgICAgICAgICAgICBkaXN0YW5jZTogNSxcclxuICAgICAgICAgICAgICAgIGNsb3NlT25DbGlja091c2lkZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGRlbGF5OiAyMDAsXHJcbiAgICAgICAgICAgICAgICBjb250YWluZXI6IHdpbmRvdyxcclxuICAgICAgICAgICAgICAgIG1hcmdpbjogMTAsXHJcbiAgICAgICAgICAgICAgICBhcHBlbmRUbzogJ2JvZHknLFxyXG4gICAgICAgICAgICB9LCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gJCh0YXJnZXRFbGVtKS5hZGRDbGFzcygnaGFzLXRvb2x0aXAnKS5kYXRhKCdfdG9vbHRpcCcsIHRoaXMpO1xyXG4gICAgICAgICAgICB0aGlzLnNob3dUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB0aGlzLnNob3coKSwgdGhpcy5vcHRpb25zLmRlbGF5KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgZ2V0Q29udGVudCgpOiBKUXVlcnkge1xyXG4gICAgICAgICAgICB2YXIgYyA9IHRoaXMub3B0aW9ucy5jb250ZW50O1xyXG4gICAgICAgICAgICBpZiAoYykge1xyXG4gICAgICAgICAgICAgICAgYyA9ICQuaXNGdW5jdGlvbihjKSA/IGMuY2FsbCh0aGlzLnRhcmdldCkgOiBjO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICFjID8gbnVsbCA6IHR5cGVvZiBjID09ICdzdHJpbmcnID8gICQoJzxkaXY+JykuaHRtbChjKSA6ICQoYyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zb3VyY2UgPT0gJ3RpdGxlJykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gdGhpcy50YXJnZXQuYXR0cigndGl0bGUnKSB8fCB0aGlzLnRhcmdldC5kYXRhKCd0aXRsZScpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50YXJnZXQuYXR0cigndGl0bGUnLCAnJykuZGF0YSgndGl0bGUnLCB0aXRsZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJCgnPGRpdj4nKS5odG1sKHRpdGxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNvdXJjZSA9PSAnYW5jaG9yJykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSAkKHRoaXMudGFyZ2V0LmF0dHIoJ2hyZWYnKSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udGVudC5sZW5ndGggPyBjb250ZW50IDogbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBzaG93KCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSB0aGlzLmdldENvbnRlbnQoKTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmNvbnRlbnQpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICBjbG9zZSgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jb250ZW50XHJcbiAgICAgICAgICAgICAgICAub2ZmKCdjbGljaycsIHRoaXMuY2xvc2VDYWxsYmFjaylcclxuICAgICAgICAgICAgICAgIC5vbignY2xpY2snLCB0aGlzLm9wdGlvbnMuY2xvc2VTZWxlY3RvciwgdGhpcy5jbG9zZUNhbGxiYWNrKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5vcHRpb25zO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFwcGVuZFRvID0gJCh0aGlzLm9wdGlvbnMuYXBwZW5kVG8pLmZpcnN0KCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnRvb2x0aXAgPSAkKCc8ZGl2IGNsYXNzPVwidG9vbHRpcC1mcmFtZVwiLz4nKVxyXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKG8uY3NzQ2xhc3MpXHJcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ3Rvb2x0aXAtJyArIG8ucG9zaXRpb24pXHJcbiAgICAgICAgICAgICAgICAuYXBwZW5kKHRoaXMuY29udGVudC5zaG93KCkpXHJcbiAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXYgY2xhc3M9XCJ0aXBcIi8+JykpXHJcbiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oYXBwZW5kVG8pO1xyXG5cclxuICAgICAgICAgICAgaWYoYXBwZW5kVG8uY3NzKCdwb3NpdGlvbicpID09ICdzdGF0aWMnKVxyXG4gICAgICAgICAgICAgICAgYXBwZW5kVG8uY3NzKCdwb3NpdGlvbicsICdyZWxhdGl2ZScpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy50YXJnZXQuZGF0YSgnX3Rvb2x0aXAnLCB0aGlzKTtcclxuICAgICAgICAgICAgdGhpcy5wb3NpdGlvbigpO1xyXG4gICAgICAgICAgICBhY3RpdmUgPSB0aGlzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHBvc2l0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgbWFyZ2luID0gdGhpcy5vcHRpb25zLm1hcmdpbjtcclxuXHJcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcy50b29sdGlwO1xyXG4gICAgICAgICAgICB2YXIgZSA9IHRoaXMudGFyZ2V0O1xyXG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMub3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgIGlmICghdClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIC8vUmVzZXQgc28gZGltZW50aW9ucyBjYWxjdWxhdGlvbnMgYXJlIGNvcnJlY3RcclxuICAgICAgICAgICAgdC5yZW1vdmVBdHRyKCdzdHlsZScpO1xyXG4gICAgICAgICAgICB2YXIgb2Zmc2V0ID0gZS5vZmZzZXQoKTtcclxuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRoaXMub3B0aW9ucy5jb250YWluZXI7XHJcbiAgICAgICAgICAgIHZhciBjb250YWluZXJMZWZ0ID0gY29udGFpbmVyID09PSB3aW5kb3cgPyAwIDogJChjb250YWluZXIpLm9mZnNldCgpLmxlZnRcclxuICAgICAgICAgICAgdmFyIG1pbkxlZnQgPSBjb250YWluZXJMZWZ0ICsgbWFyZ2luO1xyXG4gICAgICAgICAgICB2YXIgbWF4UmlnaHQgPSAoY29udGFpbmVyTGVmdCArICQoY29udGFpbmVyKS5vdXRlcldpZHRoKCkpIC0gbWFyZ2luO1xyXG5cclxuICAgICAgICAgICAgdmFyIHcgPSB0Lm91dGVyV2lkdGgoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBsZWZ0ID0gTWF0aC5tYXgobWluTGVmdCwgb2Zmc2V0LmxlZnQgKyBlLm91dGVyV2lkdGgoKSAvIDIgLSB3IC8gMik7XHJcblxyXG4gICAgICAgICAgICB2YXIgcmlnaHRPdmVyZmxvdyA9IChsZWZ0ICsgdykgLSBtYXhSaWdodDtcclxuICAgICAgICAgICAgaWYocmlnaHRPdmVyZmxvdyA+IDApXHJcbiAgICAgICAgICAgICAgICBsZWZ0ID0gTWF0aC5tYXgobWluTGVmdCwgbGVmdCAtIHJpZ2h0T3ZlcmZsb3cpXHJcblxyXG4gICAgICAgICAgICB2YXIgcGFyZW50T2Zmc2V0ID0gdC5wYXJlbnQoKS5vZmZzZXQoKTtcclxuICAgICAgICAgICAgdC5jc3Moe1xyXG4gICAgICAgICAgICAgICAgJ2xlZnQnOiAobGVmdCAtIHBhcmVudE9mZnNldC5sZWZ0KSArICdweCcsXHJcbiAgICAgICAgICAgICAgICAnbWF4LXdpZHRoJzogKG1heFJpZ2h0IC0gbGVmdCkgKyAncHgnXHJcbiAgICAgICAgICAgIH0pLmZpbmQoJy50aXAnKS5jc3MoJ2xlZnQnLCBvZmZzZXQubGVmdCArIGUub3V0ZXJXaWR0aCgpIC8gMiAtIGxlZnQgKyAncHgnKTtcclxuICAgICAgICAgICAgLy9TZXR0aW5nIHdpZHRoIGNhbiBtYWtlIGhlaWdodCB2YXJ5LiBTbyB3ZSBzZXQgdmVydGljYWwgcG9zaXRpb24gYWZ0ZXIuXHJcbiAgICAgICAgICAgIHZhciBoID0gdC5vdXRlckhlaWdodCgpO1xyXG4gICAgICAgICAgICB0LmNzcygndG9wJywgKG8ucG9zaXRpb24gPT0gJ3RvcCcgPyBvZmZzZXQudG9wIC0gaCAtIG8uZGlzdGFuY2UgOiBvZmZzZXQudG9wICsgZS5vdXRlckhlaWdodCgpICsgby5kaXN0YW5jZSkgLSBwYXJlbnRPZmZzZXQudG9wKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBjbG9zZSgpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2hvd1RpbWVvdXQpO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMudG9vbHRpcClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLnNvdXJjZSA9PSAnYW5jaG9yJylcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGVudC5oaWRlKCkuYXBwZW5kVG8oJ2JvZHknKTtcclxuICAgICAgICAgICAgdGhpcy50b29sdGlwLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLnRvb2x0aXAgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLnRhcmdldC5kYXRhKCdfdG9vbHRpcCcsIG51bGwpO1xyXG4gICAgICAgICAgICBhY3RpdmUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==